# Contributing to expo-esim-provisioning

Thank you for your interest in contributing! This guide covers everything you need to get up and running.

## Table of contents

- [Development setup](#development-setup)
- [Project structure](#project-structure)
- [Running the example app](#running-the-example-app)
- [Making changes](#making-changes)
- [Tests](#tests)
- [Changesets (versioning)](#changesets-versioning)
- [Commit conventions](#commit-conventions)
- [Pull request checklist](#pull-request-checklist)

---

## Development setup

**Prerequisites:** Node.js ≥ 18, npm, Xcode (iOS), Android Studio (Android)

```sh
git clone https://github.com/DanielMarkiel/expo-esim-provisioning.git
cd expo-esim-provisioning
npm install
```

Build the TypeScript sources:

```sh
npm run build
```

---

## Project structure

```
src/               # TypeScript source (the published API)
android/src/main/  # Kotlin native module
example/           # Bare Expo app to test the module
build/             # Compiled output (git-ignored, generated by `npm run build`)
```

Key files:

| File                                                | Purpose                                   |
| --------------------------------------------------- | ----------------------------------------- |
| `src/EsimProvisioningModule.ts`                     | JS-side wrappers around the native module |
| `src/types.ts`                                      | Public TypeScript types                   |
| `src/EsimProvisioningError.ts`                      | Typed error class                         |
| `android/src/main/java/…/EsimProvisioningModule.kt` | Android native implementation             |
| `example/App.tsx`                                   | Demo UI exercising every API              |

---

## Running the example app

### iOS

```sh
npm run open:ios   # opens Xcode workspace
# then Build & Run in Xcode
```

### Android

```sh
npm run open:android   # opens Android Studio
# then Run the 'app' configuration
```

> **Important:** eSIM functionality requires a **physical device** with eSIM hardware. Simulators and emulators do not
> support eSIM.

After making changes to `src/`, rebuild before testing:

```sh
npm run build
```

---

## Making changes

1. Create a feature branch: `git checkout -b fix/my-fix`
2. Make your changes in `src/` (TypeScript) or `android/` (Kotlin)
3. Rebuild: `npm run build`
4. Add/update tests in `src/__tests__/`
5. Run checks locally (see [Tests](#tests))
6. Add a changeset (see [Changesets](#changesets-versioning))
7. Open a PR

---

## Tests

```sh
npm test                  # run all tests
npm test -- --coverage    # with coverage report
npm run lint              # ESLint
npm run build             # TypeScript compilation check
npx tsc --noEmit          # type-check only (faster)
```

Tests live in `src/__tests__/`. The test environment mocks the native module — no device is needed for unit tests.

---

## Changesets (versioning)

This project uses [Changesets](https://github.com/changesets/changesets) for version management.

After making a user-facing change (bug fix, new feature, breaking change) **you must add a changeset**:

```sh
npx changeset
```

Follow the prompts to choose the version bump type (`patch` / `minor` / `major`) and write a short description. Commit
the generated `.changeset/*.md` file along with your code changes.

**When NOT to add a changeset:** documentation-only changes, test additions, internal refactors, CI/tooling changes.

---

## Commit conventions

We follow [Conventional Commits](https://www.conventionalcommits.org/):

```
feat: add deleteProfile() API
fix: resolve USER_CANCELED not thrown on Android 12
docs: update iOS installation flow section
chore: upgrade expo-module-scripts to v5
test: add coverage for buildActivationString edge cases
```

---

## Pull request checklist

Before opening a PR, make sure:

- [ ] `npm test` passes
- [ ] `npm run lint` passes
- [ ] `npm run build` passes
- [ ] A changeset is included (for bug fixes / features)
- [ ] README is updated (if the public API changed)
- [ ] Tested on a physical device (if the change touches native code)
